{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import*as React from'react';import'./login.scss';import Validator from'validator';import ErrorMessage from'../../../components/common/messages/error-message';import{connect}from'react-redux';import{login}from'../../../ac/auth';import{Link}from'react-router-dom';import{loaded,loading}from\"../../../ac/loader\";import SingInGoogle from'./oauth/google';import{withNamespaces}from\"react-i18next\";class Login extends React.Component{constructor(...args){var _this;super(...args);_this=this;this.state={data:{email:'',password:''},loading:false,backendErrors:[],errors:{email:null,password:null}};this.goToRegister=e=>{e.preventDefault();window.location.href='/registration';};this.onChange=e=>{this.setState({data:_objectSpread(_objectSpread({},this.state.data),{},{[e.target.name]:e.target.value})});};this.submit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _this$props,login,loading,loaded,data,errors,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_this$props=_this.props,login=_this$props.login,loading=_this$props.loading,loaded=_this$props.loaded;data=_this.state.data;e.preventDefault();errors=_this.validate(data);_this.setState({errors});if(!(!errors.email&&!errors.password)){_context.next=15;break;}_context.prev=6;loading();_context.next=10;return login(data);case 10:res=_context.sent;_this.handleErrors(res.status);case 12:_context.prev=12;loaded();return _context.finish(12);case 15:case\"end\":return _context.stop();}},_callee,null,[[6,,12,15]]);}));return function(_x){return _ref.apply(this,arguments);};}();this.validate=data=>{const errors={password:null,email:null};if(!data.password)errors.password=\"\\u041D\\u0435 \\u043C\\u043E\\u0436\\u0435\\u0442 \\u0431\\u044B\\u0442\\u044C \\u043F\\u0443\\u0441\\u0442\\u044B\\u043C\";if(!data.email)errors.email=\"\\u041D\\u0435 \\u043C\\u043E\\u0436\\u0435\\u0442 \\u0431\\u044B\\u0442\\u044C \\u043F\\u0443\\u0441\\u0442\\u044B\\u043C\";if(!Validator.isEmail(data.email))errors.email=\"\\u041D\\u0435 \\u0432\\u0430\\u043B\\u0438\\u0434\\u043D\\u044B\\u0439 \\u0435\\u043C\\u0435\\u0439\\u043B\";return errors;};}handleErrors(status){if(status<300){this.props.history.push('/');return;}else{switch(status){case 401:this.setState({backendErrors:['Подтвердите ваш почтовый адресс']});break;case 403:this.setState({backendErrors:['Неверный логин или пароль']});break;default:this.setState({backendErrors:['Произошла серверная ощибка, обратитесь к администратору']});}}}render(){const t=this.props.t;const data=this.state.data;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"form\",{className:\"col-md-6 login-form\",onSubmit:this.submit},this.state.backendErrors.map(it=>/*#__PURE__*/React.createElement(ErrorMessage,{key:it,message:it})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",null,\"E-mail \",t('адрес')),/*#__PURE__*/React.createElement(\"input\",{type:\"email\",id:\"email\",name:\"email\",placeholder:\"example@gmail.com\",value:data.email,onChange:this.onChange,className:\"form-control\"}),this.state.errors.email&&/*#__PURE__*/React.createElement(ErrorMessage,{message:this.state.errors.email})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"),/*#__PURE__*/React.createElement(\"input\",{type:\"password\",id:\"password\",name:\"password\",value:data.password,onChange:this.onChange,className:\"form-control\",placeholder:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"}),this.state.errors.password&&/*#__PURE__*/React.createElement(ErrorMessage,{message:this.state.errors.password})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"div\",{className:\"forgot-password\"},/*#__PURE__*/React.createElement(Link,{to:\"/forgot-password\"},t('Забыли'),\" \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C ?\")),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"btn submit-btn mb-2\"},t('Войти')),\"\\xA0\",/*#__PURE__*/React.createElement(\"button\",{onClick:this.goToRegister,className:\"btn submit-btn mb-2\"},t('Зарегистрировтся')),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(SingInGoogle,null))));}}export default connect(state=>({auth:state.auth}),{login,loading,loaded}// @ts-ignore\n)(withNamespaces()(Login));","map":{"version":3,"sources":["/Users/yaroslavudodov/Code/f4e/ssr/client/src/components/auth/login/login.tsx"],"names":["React","Validator","ErrorMessage","connect","login","Link","loaded","loading","SingInGoogle","withNamespaces","Login","Component","state","data","email","password","backendErrors","errors","goToRegister","e","preventDefault","window","location","href","onChange","setState","target","name","value","submit","props","validate","res","handleErrors","status","isEmail","history","push","render","t","map","it","auth"],"mappings":"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","sourcesContent":["import * as React from 'react'\nimport './login.scss'\nimport Validator from 'validator'\nimport ErrorMessage from '../../../components/common/messages/error-message'\nimport {connect} from 'react-redux'\nimport {login} from '../../../ac/auth'\nimport {Link} from 'react-router-dom'\nimport {loaded, loading} from \"../../../ac/loader\";\nimport SingInGoogle from './oauth/google'\nimport {withNamespaces} from \"react-i18next\";\ninterface Props {history: any, login: any, loading: any, loaded: any, t: any}\n\nclass Login extends React.Component<Props> {\n\n  state = {\n    data: {email: '', password: ''},\n    loading: false,\n    backendErrors: [],\n    errors: {email: null, password: null},\n  }\n\n  goToRegister = (e: any) => {\n    e.preventDefault()\n    window.location.href = '/registration'\n  }\n\n  onChange = (e: any) => {\n    this.setState({data: {...this.state.data, [e.target.name]: e.target.value}})\n  }\n\n  handleErrors(status: number){\n    if(status < 300) {\n      this.props.history.push('/')\n      return\n    } else {\n      switch (status) {\n        case 401:\n          this.setState({backendErrors: ['Подтвердите ваш почтовый адресс']})\n          break\n        case 403:\n          this.setState({backendErrors: ['Неверный логин или пароль']})\n          break\n        default:\n          this.setState({backendErrors: ['Произошла серверная ощибка, обратитесь к администратору']})\n      }\n    }\n  }\n\n  submit = async (e: any) => {\n    const {login, loading, loaded} = this.props\n    const {data} = this.state\n    e.preventDefault()\n    const errors = this.validate(data)\n    this.setState({errors})\n    if (!errors.email && !errors.password) {\n      try {\n        loading()\n        const res = await login(data)\n        this.handleErrors(res.status)\n      } finally {\n        loaded()\n      }\n    }\n  }\n\n  validate = (data: any) => {\n    const errors: {password: any, email: any} = {password: null, email: null}\n    if (!data.password) errors.password = `Не может быть пустым`\n    if (!data.email) errors.email = `Не может быть пустым`\n    if (!Validator.isEmail(data.email)) errors.email = `Не валидный емейл`\n    return errors\n  }\n\n  render() {\n    const {t} = this.props\n    const {data} = this.state;\n    return (\n      <div>\n        <form className=\"col-md-6 login-form\" onSubmit={this.submit}>\n          {\n            this.state.backendErrors.map((it) =>\n              <ErrorMessage key={it} message={it}/>)}\n          <div className=\"form-group\">\n            <label>E-mail {t('адрес')}</label>\n            <input\n              type=\"email\"\n              id=\"email\"\n              name=\"email\"\n              placeholder=\"example@gmail.com\"\n              value={data.email}\n              onChange={this.onChange}\n              className=\"form-control\"\n            />\n            {this.state.errors.email && (\n              <ErrorMessage message={this.state.errors.email} />\n            )}\n          </div>\n          <div className=\"form-group\">\n            <label>Пароль</label>\n            <input\n              type=\"password\"\n              id=\"password\"\n              name=\"password\"\n              value={data.password}\n              onChange={this.onChange}\n              className=\"form-control\"\n              placeholder=\"Пароль\"\n            />\n            {this.state.errors.password && (\n              <ErrorMessage message={this.state.errors.password} />\n            )}\n          </div>\n          <div className=\"form-group\">\n            <div className='forgot-password'>\n              <Link to=\"/forgot-password\">{t('Забыли')} пароль ?</Link>\n            </div>\n            <button type=\"submit\" className=\"btn submit-btn mb-2\">{t('Войти')}</button>\n            &nbsp;\n            <button onClick={this.goToRegister} className=\"btn submit-btn mb-2\">{t('Зарегистрировтся')}</button>\n            <br/>\n            <SingInGoogle/>\n          </div>\n        </form>\n      </div>\n    )\n  }\n}\n\n\nexport default connect(\n    (state: {auth: any}) => ({\n      auth: state.auth,\n    }), {login, loading, loaded}\n    // @ts-ignore\n)(withNamespaces()(Login))\n"]},"metadata":{},"sourceType":"module"}