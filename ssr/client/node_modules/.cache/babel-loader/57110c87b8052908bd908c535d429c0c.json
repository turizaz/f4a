{"ast":null,"code":"import _objectSpread from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{SET_CURRENT_USER}from'../constants';import axios from'../libs/axios';export function setCurrentUser(user){return{type:SET_CURRENT_USER,user};}export function checkIfLogged(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"/auth/ping\");case 3:response=_context.sent;_context.next=10;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);if(_context.t0.message.indexOf('code 401')!==-1){dispatch(setCurrentUser(null));}response=_context.t0.message;case 10:return _context.abrupt(\"return\",response);case 11:case\"end\":return _context.stop();}},_callee,null,[[0,6]]);}));return function(_x){return _ref.apply(this,arguments);};}();}export function login(credentials){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"/auth/login\",credentials);case 3:response=_context2.sent;dispatch(setCurrentUser(response.data));return _context2.abrupt(\"return\",_objectSpread(_objectSpread({},response.data),{},{status:response.status}));case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",_context2.t0.response);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();}export function forgotPassword(email){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.post(\"/auth/forgot-password\",{email});case 3:response=_context3.sent;return _context3.abrupt(\"return\",_objectSpread(_objectSpread({},response.data),{},{status:response.status}));case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",_context3.t0.response);case 10:case\"end\":return _context3.stop();}},_callee3,null,[[0,7]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();}export function changePassword(password){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return axios.post(\"/auth/change-password\",{password});case 3:response=_context4.sent;return _context4.abrupt(\"return\",_objectSpread(_objectSpread({},response.data),{},{status:response.status}));case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](0);return _context4.abrupt(\"return\",_context4.t0.response);case 10:case\"end\":return _context4.stop();}},_callee4,null,[[0,7]]);}));return function(_x4){return _ref4.apply(this,arguments);};}();}export function registration(user){return dispatch=>{return new Promise((resolve,reject)=>{axios.post(\"/auth/registration\",user).then(res=>{resolve(res);}).catch(err=>{console.log(err.response.data);dispatch(setCurrentUser({}));reject(err.response);});});};}export function logout(){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:_context5.next=2;return axios.post(\"/auth/logout\",{});case 2:localStorage.removeItem('user');dispatch(setCurrentUser({}));case 4:case\"end\":return _context5.stop();}},_callee5);}));return function(_x5){return _ref5.apply(this,arguments);};}();}export function setUser(user){console.log(\"set user\");return dispatch=>{dispatch(setCurrentUser(user));};}","map":{"version":3,"sources":["/Users/yaroslavudodov/Code/f4e/ssr/client/src/ac/auth.ts"],"names":["SET_CURRENT_USER","axios","setCurrentUser","user","type","checkIfLogged","dispatch","get","response","message","indexOf","login","credentials","post","data","status","forgotPassword","email","changePassword","password","registration","Promise","resolve","reject","then","res","catch","err","console","log","logout","localStorage","removeItem","setUser"],"mappings":"4dAAA,OAAQA,gBAAR,KAA+B,cAA/B,CACA,MAAOC,CAAAA,KAAP,KAAkB,eAAlB,CAEA,MAAO,SAASC,CAAAA,cAAT,CAAwBC,IAAxB,CAAmC,CACxC,MAAO,CACLC,IAAI,CAAEJ,gBADD,CAELG,IAFK,CAAP,CAID,CACD,MAAO,SAASE,CAAAA,aAAT,EAAyB,CAC9B,+FAAO,iBAAOC,QAAP,oKAGcL,CAAAA,KAAK,CAACM,GAAN,cAHd,QAGHC,QAHG,8FAKH,GAAI,YAAEC,OAAF,CAAUC,OAAV,CAAkB,UAAlB,IAAkC,CAAC,CAAvC,CAA0C,CACxCJ,QAAQ,CAACJ,cAAc,CAAC,IAAD,CAAf,CAAR,CACD,CACDM,QAAQ,CAAG,YAAEC,OAAb,CARG,wCAUED,QAVF,qEAAP,+DAYD,CACD,MAAO,SAASG,CAAAA,KAAT,CAAeC,WAAf,CAAsC,CAC3C,gGAAO,kBAAON,QAAP,0KAEoBL,CAAAA,KAAK,CAACY,IAAN,eAA0BD,WAA1B,CAFpB,QAEGJ,QAFH,gBAGHF,QAAQ,CAACJ,cAAc,CAACM,QAAQ,CAACM,IAAV,CAAf,CAAR,CAHG,gEAIQN,QAAQ,CAACM,IAJjB,MAIuBC,MAAM,CAAEP,QAAQ,CAACO,MAJxC,gGAMI,aAAEP,QANN,uEAAP,iEASD,CAED,MAAO,SAASQ,CAAAA,cAAT,CAAwBC,KAAxB,CAAuC,CAC5C,gGAAO,kBAAOX,QAAP,0KAEoBL,CAAAA,KAAK,CAACY,IAAN,yBAAoC,CAACI,KAAD,CAApC,CAFpB,QAEGT,QAFH,gFAGQA,QAAQ,CAACM,IAHjB,MAGuBC,MAAM,CAAEP,QAAQ,CAACO,MAHxC,gGAKI,aAAEP,QALN,uEAAP,iEAQD,CAED,MAAO,SAASU,CAAAA,cAAT,CAAwBC,QAAxB,CAA0C,CAC/C,gGAAO,kBAAOb,QAAP,0KAEoBL,CAAAA,KAAK,CAACY,IAAN,yBAAoC,CAACM,QAAD,CAApC,CAFpB,QAEGX,QAFH,gFAGQA,QAAQ,CAACM,IAHjB,MAGuBC,MAAM,CAAEP,QAAQ,CAACO,MAHxC,gGAKI,aAAEP,QALN,uEAAP,iEAQD,CACD,MAAO,SAASY,CAAAA,YAAT,CAAsBjB,IAAtB,CAAiC,CACtC,MAAQG,CAAAA,QAAD,EAAmB,CACxB,MAAO,IAAIe,CAAAA,OAAJ,CAAY,CAACC,OAAD,CAAUC,MAAV,GAAoB,CACrCtB,KAAK,CACAY,IADL,sBACgCV,IADhC,EAEKqB,IAFL,CAEWC,GAAD,EAAS,CACbH,OAAO,CAACG,GAAD,CAAP,CACD,CAJL,EAKKC,KALL,CAKYC,GAAD,EAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACnB,QAAJ,CAAaM,IAAzB,EACAR,QAAQ,CAACJ,cAAc,CAAC,EAAD,CAAf,CAAR,CACAqB,MAAM,CAACI,GAAG,CAACnB,QAAL,CAAN,CACD,CATL,EAUD,CAXM,CAAP,CAYD,CAbD,CAcD,CAED,MAAO,SAASsB,CAAAA,MAAT,EAAkB,CACvB,gGAAO,kBAAOxB,QAAP,4IACCL,CAAAA,KAAK,CAACY,IAAN,gBAA2B,EAA3B,CADD,QAELkB,YAAY,CAACC,UAAb,CAAwB,MAAxB,EACA1B,QAAQ,CAACJ,cAAc,CAAC,EAAD,CAAf,CAAR,CAHK,uDAAP,iEAKD,CAED,MAAO,SAAS+B,CAAAA,OAAT,CAAiB9B,IAAjB,CAA4B,CACjCyB,OAAO,CAACC,GAAR,aACA,MAAQvB,CAAAA,QAAD,EAAmB,CACxBA,QAAQ,CAACJ,cAAc,CAACC,IAAD,CAAf,CAAR,CACD,CAFD,CAGD","sourcesContent":["import {SET_CURRENT_USER} from '../constants'\nimport axios from '../libs/axios'\n\nexport function setCurrentUser(user: any) {\n  return {\n    type: SET_CURRENT_USER,\n    user,\n  }\n}\nexport function checkIfLogged() {\n  return async (dispatch: any) => {\n    let response;\n    try {\n      response = await axios.get(`/auth/ping`);\n    } catch (e) {\n      if (e.message.indexOf('code 401') !== -1) {\n        dispatch(setCurrentUser(null))\n      }\n      response = e.message\n    }\n    return response\n  }\n}\nexport function login(credentials: any): any {\n  return async (dispatch: any) => {\n    try {\n      const response = await axios.post(`/auth/login`, credentials)\n      dispatch(setCurrentUser(response.data))\n      return {...response.data, status: response.status}\n    } catch (e) {\n      return e.response\n    }\n  }\n}\n\nexport function forgotPassword(email: string) {\n  return async (dispatch: any) => {\n    try{\n      const response = await axios.post(`/auth/forgot-password`, {email})\n      return {...response.data, status: response.status}\n    } catch (e) {\n      return e.response\n    }\n  }\n}\n\nexport function changePassword(password: string) {\n  return async (dispatch: any) => {\n    try {\n      const response = await axios.post(`/auth/change-password`, {password})\n      return {...response.data, status: response.status}\n    } catch (e) {\n      return e.response\n    }\n  }\n}\nexport function registration(user: any) {\n  return (dispatch: any) => {\n    return new Promise((resolve, reject)=> {\n      axios\n          .post(`/auth/registration`, user)\n          .then((res) => {\n            resolve(res)\n          })\n          .catch((err) => {\n            console.log(err.response.data)\n            dispatch(setCurrentUser({}))\n            reject(err.response)\n          });\n    });\n  };\n}\n\nexport function logout() {\n  return async (dispatch: any) => {\n    await axios.post(`/auth/logout`, {})\n    localStorage.removeItem('user')\n    dispatch(setCurrentUser({}))\n  };\n}\n\nexport function setUser(user: any) {\n  console.log(`set user`)\n  return (dispatch: any) => {\n    dispatch(setCurrentUser(user))\n  };\n}\n"]},"metadata":{},"sourceType":"module"}