{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/yaroslavudodov/Code/f4e/ssr/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import*as React from'react';import'./registration.scss';import ErrorMessage from'../../../components/common/messages/error-message';import Validator from'validator';import _ from'lodash';import{registration}from'../../../ac/auth';import{connect}from'react-redux';import{loaded,loading}from\"../../../ac/loader\";import{withNamespaces}from\"react-i18next\";/**\n * Registration page\n */class Registration extends React.Component{constructor(...args){var _this;super(...args);_this=this;this.state={data:{email:'',password:'',name:'',repeatPassword:''},loading:false,errors:{email:null,repeatPassword:null,password:null,name:null},backendErrors:[]};this.onChange=e=>{this.setState({data:_objectSpread(_objectSpread({},this.state.data),{},{[e.target.name]:e.target.value})});};this.validate=data=>{const t=this.props.t;const errors={password:null,email:null,name:null,repeatPassword:null};if(!data.password)errors.password=t(\"\\u041D\\u0435 \\u043C\\u043E\\u0436\\u0435\\u0442 \\u0431\\u044B\\u0442\\u044C \\u043F\\u0443\\u0441\\u0442\\u044B\\u043C\");if(!data.email)errors.email=t(\"\\u041D\\u0435 \\u043C\\u043E\\u0436\\u0435\\u0442 \\u0431\\u044B\\u0442\\u044C \\u043F\\u0443\\u0441\\u0442\\u044B\\u043C\");if(!data.name)errors.name=t(\"\\u041D\\u0435 \\u043C\\u043E\\u0436\\u0435\\u0442 \\u0431\\u044B\\u0442\\u044C \\u043F\\u0443\\u0441\\u0442\\u044B\\u043C\");if(!data.password!==!data.repeatPassword){errors.repeatPassword=t(\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u0438 \\u043D\\u0435 \\u0441\\u043E\\u0432\\u043F\\u0430\\u0434\\u0430\\u044E\\u0442\");}if(!Validator.isEmail(data.email))errors.email=t(\"\\u041D\\u0435 \\u0432\\u0430\\u043B\\u0438\\u0434\\u043D\\u044B\\u0439 \\u0435\\u043C\\u0435\\u0439\\u043B\");return errors;};this.onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var t,data,errors,i,registrationData,_this$props,registration,loading,loaded;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:t=_this.props.t;data=_this.state.data;e.preventDefault();errors=_this.validate(data);_this.setState({errors});_context.t0=_regeneratorRuntime.keys(errors);case 6:if((_context.t1=_context.t0()).done){_context.next=12;break;}i=_context.t1.value;if(!errors[i]){_context.next=10;break;}return _context.abrupt(\"return\");case 10:_context.next=6;break;case 12:registrationData=_.pick(data,['name','password','email']);_this$props=_this.props,registration=_this$props.registration,loading=_this$props.loading,loaded=_this$props.loaded;_context.prev=14;loading();_context.next=18;return registration(registrationData);case 18:_this.props.history.push(\"/complete-registration\");_context.next=29;break;case 21:_context.prev=21;_context.t2=_context[\"catch\"](14);_context.t3=_context.t2.status;_context.next=_context.t3===403?26:28;break;case 26:_this.setState({backendErrors:[t('Такой пользователь уже существует')]});return _context.abrupt(\"break\",29);case 28:_this.setState({backendErrors:_context.t2.data.errors});case 29:_context.prev=29;loaded();return _context.finish(29);case 32:case\"end\":return _context.stop();}},_callee,null,[[14,21,29,32]]);}));return function(_x){return _ref.apply(this,arguments);};}();}render(){const t=this.props.t;const data=this.state.data;return/*#__PURE__*/React.createElement(\"form\",{className:\" col-12 col-md-12 col-sm-12 col-lg-6 col-xl-6 login-form\",onSubmit:this.onSubmit},this.state.backendErrors?this.state.backendErrors.map(it=>/*#__PURE__*/React.createElement(ErrorMessage,{key:it,message:it})):null,/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u041D\\u0438\\u043A\"),/*#__PURE__*/React.createElement(\"input\",{type:\"name\",id:\"name\",name:\"name\",value:data.name,placeholder:t('Будет отображатся в интерфейсе'),onChange:this.onChange,className:\"form-control\"}),this.state.errors.name&&/*#__PURE__*/React.createElement(ErrorMessage,{message:this.state.errors.name})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"exampleInputEmail1\"},\"E-mail \",t('адрес')),/*#__PURE__*/React.createElement(\"input\",{type:\"email\",id:\"email\",name:\"email\",placeholder:\"example@gmail.com\",value:data.email,onChange:this.onChange,className:\"form-control\"}),this.state.errors.email&&/*#__PURE__*/React.createElement(ErrorMessage,{message:this.state.errors.email})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"),/*#__PURE__*/React.createElement(\"input\",{type:\"password\",id:\"password\",name:\"password\",value:data.password,onChange:this.onChange,className:\"form-control\",placeholder:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"}),this.state.errors.password&&/*#__PURE__*/React.createElement(ErrorMessage,{message:this.state.errors.password})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"input\",{type:\"password\",id:\"repeatPassword\",name:\"repeatPassword\",value:data.repeatPassword,onChange:this.onChange,className:\"form-control\",placeholder:t(\"Повторите пароль\")}),this.state.errors.repeatPassword&&/*#__PURE__*/React.createElement(ErrorMessage,{message:this.state.errors.repeatPassword})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"btn submit-btn mb-2\"},t('Зарегистрировтся'))));}}// @ts-ignore\nexport default connect(null,{registration,loading,loaded})(withNamespaces()(Registration));","map":{"version":3,"sources":["/Users/yaroslavudodov/Code/f4e/ssr/client/src/components/auth/registration/registration.tsx"],"names":["React","ErrorMessage","Validator","_","registration","connect","loaded","loading","withNamespaces","Registration","Component","state","data","email","password","name","repeatPassword","errors","backendErrors","onChange","e","setState","target","value","validate","t","props","isEmail","onSubmit","preventDefault","i","registrationData","pick","history","push","status","render","map","it"],"mappings":"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","sourcesContent":["import * as React from 'react'\nimport './registration.scss'\nimport ErrorMessage from '../../../components/common/messages/error-message'\nimport Validator from 'validator'\n\nimport _ from 'lodash'\nimport {registration} from '../../../ac/auth'\nimport {connect} from 'react-redux'\nimport {loaded, loading} from \"../../../ac/loader\";\nimport {withNamespaces} from \"react-i18next\";\n\ninterface Props {\n  registration: any,\n  history: any,\n  loading:any,\n  loaded: any,\n  t: any\n}\n\n/**\n * Registration page\n */\nclass Registration extends React.Component<Props> {\n\n  state = {\n    data: {\n      email: '',\n      password: '',\n      name: '',\n      repeatPassword: '',\n    },\n    loading: false,\n    errors: {email: null, repeatPassword: null, password: null, name: null},\n    backendErrors: [],\n  }\n\n  /**\n   * Handle all simple text inputs\n   * @param {object} e\n   * @return {void}\n   */\n  onChange = (e: any) => {\n    this.setState({\n      data: {...this.state.data, [e.target.name]: e.target.value},\n    })\n  };\n\n  /**\n   * Form validation\n   * @return {object}\n   */\n  validate = (data: any) => {\n    const {t} = this.props\n    const errors : {\n      password: string | null,\n      email: string | null,\n      name: string | null,\n      repeatPassword: string | null\n    } = {password: null, email: null, name: null, repeatPassword: null}\n    if (!data.password) errors.password = t(`Не может быть пустым`)\n    if (!data.email) errors.email = t(`Не может быть пустым`)\n    if (!data.name) errors.name = t(`Не может быть пустым`)\n    if (!data.password !== !data.repeatPassword) {\n      errors.repeatPassword = t(`Пароли не совпадают`)\n    }\n    if (!Validator.isEmail(data.email)) errors.email = t(`Не валидный емейл`)\n    return errors\n  };\n\n  onSubmit = async (e: any) => {\n    const {t} = this.props\n    const {data} = this.state\n    e.preventDefault()\n    const errors: any = this.validate(data)\n    this.setState({errors})\n    for (const i in errors) {\n      if (errors[i]) {\n        return\n      }\n    }\n    const registrationData = _.pick(data, ['name', 'password', 'email'])\n    const { registration, loading, loaded } = this.props\n    try {\n      loading()\n      await registration(registrationData)\n      this.props.history.push(`/complete-registration`)\n    } catch (err) {\n      switch (err.status) {\n        case 403:\n          this.setState({backendErrors: [t('Такой пользователь уже существует')]}\n          )\n          break\n        default:\n          this.setState({backendErrors: err.data.errors})\n      }\n    } finally {\n      loaded()\n    }\n  };\n\n  render() {\n    const {t} = this.props\n    const {data} = this.state;\n    return (\n      <form className=\"\n      col-12\n      col-md-12\n      col-sm-12\n      col-lg-6\n      col-xl-6\n      login-form\" onSubmit={this.onSubmit}>\n        {\n          this.state.backendErrors ? this.state.backendErrors.map(\n              (it) => <ErrorMessage key={it} message={it}/>) : null\n        }\n        <div className=\"form-group\">\n          <label>Ник</label>\n          <input\n            type=\"name\"\n            id=\"name\"\n            name=\"name\"\n            value={data.name}\n            placeholder={t('Будет отображатся в интерфейсе')}\n            onChange={this.onChange}\n            className=\"form-control\"\n          />\n          {this.state.errors.name && (\n            <ErrorMessage message={this.state.errors.name} />\n          )}\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"exampleInputEmail1\">E-mail {t('адрес')}</label>\n          <input\n            type=\"email\"\n            id=\"email\"\n            name=\"email\"\n            placeholder=\"example@gmail.com\"\n            value={data.email}\n            onChange={this.onChange}\n            className=\"form-control\"\n          />\n          {this.state.errors.email && (\n            <ErrorMessage message={this.state.errors.email} />\n          )}\n        </div>\n\n        <div className=\"form-group\">\n          <label>Пароль</label>\n          <input\n            type=\"password\"\n            id=\"password\"\n            name=\"password\"\n            value={data.password}\n            onChange={this.onChange}\n            className=\"form-control\"\n            placeholder=\"Пароль\"\n          />\n          {this.state.errors.password && (\n            <ErrorMessage message={this.state.errors.password} />\n          )}\n        </div>\n        <div className=\"form-group\">\n          <input\n            type=\"password\"\n            id=\"repeatPassword\"\n            name=\"repeatPassword\"\n            value={data.repeatPassword}\n            onChange={this.onChange}\n            className=\"form-control\"\n            placeholder={t(\"Повторите пароль\")}\n          />\n          {this.state.errors.repeatPassword && (\n            <ErrorMessage message={this.state.errors.repeatPassword} />\n          )}\n        </div>\n        <div className=\"form-group\">\n          <button type=\"submit\" className=\"btn submit-btn mb-2\">\n            {t('Зарегистрировтся')}\n          </button>\n        </div>\n      </form>\n    )\n  }\n}\n\n// @ts-ignore\nexport default connect(null, {registration, loading, loaded})(withNamespaces()(Registration))\n"]},"metadata":{},"sourceType":"module"}